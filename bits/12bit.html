<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Laboratório de Arquitetura: 12 Bits Full Scale</title>
    <style>
        :root { 
            --cpu: #fbbf24; --bin: #00d4ff; --bg: #020617; 
            --panel: #1e293b; --success: #22c55e; --error: #ef4444;
        }
        body { font-family: 'Consolas', monospace; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .dashboard { display: flex; gap: 20px; margin-bottom: 20px; background: var(--panel); padding: 20px; border-radius: 15px; border: 2px solid #334155; }
        .stage { width: 1100px; height: 600px; background: #0f172a; border: 4px solid #334155; border-radius: 20px; position: relative; overflow: hidden; }
        .block { position: absolute; border: 2px solid #475569; border-radius: 12px; padding: 15px; background: rgba(0,0,0,0.3); }
        
        /* Ajuste de largura para os 12 bits */
        .registers { top: 20px; left: 20px; width: 420px; }
        .ula { top: 20px; left: 470px; width: 300px; height: 380px; border-color: var(--cpu); text-align: center; }
        .logic-gates { top: 20px; right: 20px; width: 240px; }
        .output { bottom: 180px; left: 320px; width: 600px; border-color: var(--success); }

        /* Slots menores para caberem 12 na linha */
        .bit-slot { width: 32px; height: 45px; border: 1px solid #334155; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; background: #000; transition: 0.3s; }
        .bit-row { display: flex; gap: 4px; margin-top: 10px; justify-content: center; }
        
        .active { color: var(--bin); border-color: var(--bin); box-shadow: 0 0 10px var(--bin); }
        .gate { padding: 10px; margin: 10px 0; border: 1px solid #334155; border-radius: 8px; font-size: 0.8rem; opacity: 0.4; transition: 0.3s; }
        .gate.on { opacity: 1; border-color: var(--cpu); background: rgba(251, 191, 36, 0.1); }
        .particle { position: absolute; width: 35px; height: 35px; background: var(--bin); border-radius: 50%; color: black; display: flex; align-items: center; justify-content: center; font-size: 1rem; font-weight: bold; z-index: 100; transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 0 15px var(--bin); }
        .carry-particle { position: absolute; width: 20px; height: 20px; background: var(--error); border-radius: 50%; z-index: 110; transition: all 0.6s ease-in-out; box-shadow: 0 0 15px var(--error); }
        .info-panel { position: absolute; bottom: 0; width: 100%; height: 150px; background: #000; padding: 20px; border-top: 4px solid var(--bin); }
        .overflow-led { position: absolute; top: 20px; right: 20px; padding: 10px; border-radius: 5px; background: #310000; color: #660000; font-weight: bold; }
        .overflow-active { background: var(--error) !important; color: white !important; box-shadow: 0 0 20px var(--error); }
        input { background: #0f172a; color: var(--bin); border: 1px solid var(--bin); padding: 8px; border-radius: 5px; width: 80px; font-size: 1.1rem; }
        button { padding: 12px 20px; background: var(--bin); border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: #000; }
    </style>
</head>
<body>
    <div class="dashboard">
        <div>A (0-4095): <input type="number" id="inA" value="2047"></div>
        <div>B (0-4095): <input type="number" id="inB" value="1"></div>
        <button id="stepBtn" onclick="proximoPasso()">PRÓXIMO PULSO ⚡</button>
        <button onclick="resetar()" style="background:#475569">RESET</button>
    </div>

    <div class="stage" id="stage">
        <div id="overflow-indicator" class="overflow-led">OVERFLOW</div>
        <div class="block registers">
            <small>REGISTRADORES (12 BITS)</small>
            <div class="bit-row" id="rowA"></div>
            <div class="bit-row" id="rowB"></div>
        </div>
        <div class="block ula">
            <b style="color:var(--cpu)">U.L.A.</b>
            <div id="ula-box" style="background:#020617; padding: 20px; border-radius: 10px; border: 1px solid var(--cpu)">
                <div id="ula-display" style="font-size: 1.8rem;">-- + --</div>
                <div id="ula-carry-text" style="margin-top:10px; color: var(--error)">Carry In: 0</div>
            </div>
        </div>
        <div class="block logic-gates">
            <small>PORTAS LÓGICAS</small>
            <div id="gate-xor" class="gate">XOR (Soma)</div>
            <div id="gate-and" class="gate">AND (Gera Carry)</div>
        </div>
        <div class="block output">
            <div class="bit-row" id="rowR"></div>
            <div id="decimal-res" style="text-align:center; margin-top:15px; font-weight: bold; color: var(--success); font-size: 1.2rem;">Soma: 0 (0x0)</div>
        </div>
        <div class="info-panel">
            <div id="msg-title" style="color:var(--bin); font-weight: bold;">[SISTEMA 12-BITS PRONTO]</div>
            <div id="msg-body">Aguardando clock para processar 12 ciclos...</div>
        </div>
    </div>

    <script>
        let passoAtual = -1;
        let carryGlobal = 0;
        let binA = ""; let binB = "";
        const wait = ms => new Promise(res => setTimeout(res, ms));

        // Inicializa os slots de 12 bits dinamicamente para manter o HTML limpo
        function initSlots() {
            const rows = ['rowA', 'rowB', 'rowR'];
            rows.forEach(rowId => {
                const container = document.getElementById(rowId);
                container.innerHTML = '';
                for(let i=11; i>=0; i--) {
                    const prefix = rowId === 'rowA' ? 'a' : (rowId === 'rowB' ? 'b' : 'r');
                    container.innerHTML += `<div class="bit-slot" id="${prefix}${i}"></div>`;
                }
            });
        }
        initSlots();

        async function animarCarry() {
            const ula = document.getElementById('ula-box').getBoundingClientRect();
            const stage = document.getElementById('stage').getBoundingClientRect();
            const p = document.createElement('div');
            p.className = 'carry-particle';
            p.style.left = (ula.left - stage.left + 140) + 'px';
            p.style.top = (ula.top - stage.top + 50) + 'px';
            document.getElementById('stage').appendChild(p);
            await wait(50);
            p.style.left = (ula.left - stage.left + 140) + 'px';
            p.style.top = (ula.top - stage.top - 40) + 'px';
            await wait(600);
            p.remove();
        }

        async function animarBit(valor, deId, paraId) {
            const de = document.getElementById(deId).getBoundingClientRect();
            const para = document.getElementById(paraId).getBoundingClientRect();
            const stage = document.getElementById('stage').getBoundingClientRect();
            const p = document.createElement('div');
            p.className = 'particle'; p.innerText = valor;
            p.style.left = (de.left - stage.left) + 'px';
            p.style.top = (de.top - stage.top) + 'px';
            document.getElementById('stage').appendChild(p);
            await wait(50);
            p.style.left = (para.left - stage.left + 20) + 'px';
            p.style.top = (para.top - stage.top + 20) + 'px';
            await wait(800);
            p.remove();
        }

        function resetar() {
            passoAtual = -1; carryGlobal = 0;
            document.querySelectorAll('.bit-slot').forEach(s => { s.innerText = ''; s.classList.remove('active'); });
            document.getElementById('stepBtn').disabled = false;
            document.getElementById('ula-display').innerText = "-- + --";
            document.getElementById('decimal-res').innerText = "Soma: 0 (0x0)";
            document.getElementById('overflow-indicator').classList.remove('overflow-active');
            document.getElementById('ula-carry-text').innerText = "Carry In: 0";
        }

        function atualizarResultado() {
            let resBin = "";
            for(let i=11; i>=0; i--) {
                let val = document.getElementById(`r${i}`).innerText;
                resBin += (val === "" ? "0" : val);
            }
            let dec = parseInt(resBin, 2);
            document.getElementById('decimal-res').innerText = `Soma: ${dec} (0x${dec.toString(16).toUpperCase()})`;
        }

        async function proximoPasso() {
            const inA = parseInt(document.getElementById('inA').value) || 0;
            const inB = parseInt(document.getElementById('inB').value) || 0;
            
            if (passoAtual === -1) {
                binA = inA.toString(2).padStart(12, '0');
                binB = inB.toString(2).padStart(12, '0');
                for(let i=0; i<12; i++) {
                    document.getElementById(`a${11-i}`).innerText = binA[i];
                    document.getElementById(`b${11-i}`).innerText = binB[i];
                }
                passoAtual = 0; return;
            }
            
            if (passoAtual < 12) {
                let i = passoAtual;
                const bA = parseInt(binA[11-i]); const bB = parseInt(binB[11-i]);
                document.getElementById(`a${i}`).classList.add('active');
                document.getElementById(`b${i}`).classList.add('active');
                
                await Promise.all([animarBit(bA, `a${i}`, 'ula-display'), animarBit(bB, `b${i}`, 'ula-display')]);
                
                let soma = bA + bB + carryGlobal;
                let res = soma % 2;
                
                document.getElementById('gate-xor').classList.toggle('on', bA ^ bB);
                document.getElementById('gate-and').classList.toggle('on', bA && bB);
                document.getElementById('ula-display').innerText = `${bA}+${bB}+(${carryGlobal})`;
                
                await wait(400);
                if (soma >= 2) await animarCarry();
                
                await animarBit(res, 'ula-display', `r${i}`);
                document.getElementById(`r${i}`).innerText = res;
                document.getElementById(`r${i}`).classList.add('active');
                
                atualizarResultado();
                carryGlobal = soma >= 2 ? 1 : 0;
                document.getElementById('ula-carry-text').innerText = `Carry In: ${carryGlobal}`;
                passoAtual++;
            } else if (carryGlobal > 0) {
                document.getElementById('overflow-indicator').classList.add('overflow-active');
                document.getElementById('stepBtn').disabled = true;
            }
        }
    </script>
</body>
</html>